<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADA Ltda - Portal de Adopci√≥n IA | AIWIS</title>
    <style>
        :root {
            --azul-principal: #1e40af;
            --violeta-mentor: #7c3aed;
            --azul-claro: #3b82f6;
            --violeta-claro: #8b5cf6;
            --verde-exito: #10b981;
            --naranja: #f59e0b;
            --rojo: #ef4444;
            --gris-texto: #64748b;
            --fondo-claro: #f8fafc;
            --blanco: #ffffff;
            --negro: #0f172a;
            --borde: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--blanco);
        }

        /* === PANTALLA DE LOGIN === */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-box {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 3rem;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            color: rgba(255,255,255,0.8);
            font-weight: 500;
        }

        .form-group select {
            padding: 1rem;
            border-radius: 10px;
            border: 2px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05);
            color: var(--blanco);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group select:focus {
            outline: none;
            border-color: var(--azul-claro);
            background: rgba(255,255,255,0.1);
        }

        .form-group select option {
            background: var(--negro);
            color: var(--blanco);
        }

        .login-btn {
            padding: 1rem;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            border: none;
            border-radius: 10px;
            color: var(--blanco);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .login-error {
            color: var(--rojo);
            text-align: center;
            padding: 1rem;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 10px;
            display: none;
        }

        .login-error.show {
            display: block;
        }

        /* === NAVEGACI√ìN === */
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            gap: 0.5rem;
            list-style: none;
        }

        .nav-link {
            padding: 0.7rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            font-weight: 500;
        }

        .nav-link:hover {
            background: rgba(59, 130, 246, 0.2);
            color: var(--blanco);
        }

        .nav-link.active {
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            color: var(--blanco);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
        }

        .logout-btn {
            padding: 0.6rem 1.2rem;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--rojo);
            border-radius: 8px;
            color: var(--blanco);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--rojo);
        }

        /* === CONTENIDO PRINCIPAL === */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .section-title {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 2rem;
            text-align: center;
        }

        /* === TARJETA DE PROGRESO === */
        .progress-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .progress-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .progress-stats {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
        }

        .progress-bar-container {
            background: rgba(255,255,255,0.1);
            height: 40px;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--azul-claro), var(--violeta-claro));
            border-radius: 20px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--blanco);
            font-weight: bold;
            font-size: 1rem;
        }

        /* === INDICADOR DE SINCRONIZACI√ìN === */
        .sync-indicator {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: rgba(16, 185, 129, 0.9);
            color: var(--blanco);
            padding: 1rem 1.5rem;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            z-index: 2000;
            font-weight: 500;
        }

        .sync-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        .sync-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: var(--blanco);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === FASES Y SEMANAS === */
        .phase-selector {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .fase-btn {
            padding: 1rem 2.5rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 15px;
            color: rgba(255,255,255,0.8);
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .fase-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--azul-claro);
            transform: translateY(-2px);
        }

        .fase-btn.active {
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            border-color: transparent;
            color: var(--blanco);
        }

        .week-selector {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .week-btn {
            padding: 0.8rem 2rem;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            color: rgba(255,255,255,0.8);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .week-btn:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--azul-claro);
        }

        .week-btn.active {
            background: var(--azul-claro);
            border-color: var(--azul-claro);
            color: var(--blanco);
        }

        /* === CARRUSEL DE VIDEOS === */
        .week-content {
            display: none;
        }

        .week-content.active {
            display: block;
        }

        .videos-carousel {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 1rem 0;
        }

        .video-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.3);
            border-color: var(--azul-claro);
        }

        .video-thumbnail {
            position: relative;
            width: 100%;
            height: 180px;
            background: rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: rgba(59, 130, 246, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--blanco);
            transition: all 0.3s;
        }

        .video-card:hover .play-button {
            transform: translate(-50%, -50%) scale(1.1);
            background: var(--azul-claro);
        }

        .video-progress {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }

        .progress-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--verde-exito);
        }

        .progress-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--verde-exito);
            color: var(--blanco);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .video-info {
            padding: 1.2rem;
        }

        .video-day {
            font-size: 0.85rem;
            color: var(--azul-claro);
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .video-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: var(--blanco);
        }

        .video-description {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 0.8rem;
            line-height: 1.4;
        }

        .video-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
        }

        /* === MODAL DE CLASE === */
        .class-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            padding: 2rem;
        }

        .class-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.98);
            border-radius: 20px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-title-section h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .modal-meta {
            display: flex;
            gap: 1.5rem;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.7);
        }

        .modal-close-btn {
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: var(--blanco);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s;
        }

        .modal-close-btn:hover {
            background: var(--rojo);
        }

        .modal-video {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #000;
        }

        .modal-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .modal-tab {
            flex: 1;
            padding: 1rem;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .modal-tab:hover {
            color: var(--blanco);
            background: rgba(255,255,255,0.05);
        }

        .modal-tab.active {
            color: var(--azul-claro);
            border-bottom-color: var(--azul-claro);
        }

        .modal-body {
            padding: 2rem;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content p {
            margin-bottom: 1rem;
            line-height: 1.8;
            color: rgba(255,255,255,0.8);
        }

        .tab-content h4 {
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            color: var(--azul-claro);
        }

        /* === PANEL DE ADMINISTRACI√ìN === */
        .admin-panel {
            display: none;
        }

        .admin-header {
            background: rgba(255,255,255,0.05);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .metric-card {
            background: rgba(59, 130, 246, 0.1);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            text-align: center;
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-top: 0.5rem;
        }

        .admin-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .admin-btn {
            padding: 0.8rem 1.5rem;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--azul-claro);
            border-radius: 10px;
            color: var(--blanco);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: var(--azul-claro);
            transform: translateY(-2px);
        }

        .filters-section {
            background: rgba(255,255,255,0.05);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-input {
            padding: 0.8rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: var(--blanco);
            flex: 1;
            min-width: 200px;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--azul-claro);
        }

        .students-table-container {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .students-table {
            width: 100%;
            border-collapse: collapse;
        }

        .students-table th {
            background: rgba(59, 130, 246, 0.2);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: var(--azul-claro);
        }

        .students-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .students-table tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .progress-mini {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .progress-mini-bar {
            flex: 1;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-mini-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--azul-claro), var(--verde-exito));
            border-radius: 10px;
            transition: width 0.3s;
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge.completado {
            background: rgba(16, 185, 129, 0.2);
            color: var(--verde-exito);
        }

        .status-badge.en-progreso {
            background: rgba(245, 158, 11, 0.2);
            color: var(--naranja);
        }

        .status-badge.no-iniciado {
            background: rgba(100, 116, 139, 0.2);
            color: var(--gris-texto);
        }

        /* === RANKING === */
        .ranking-section {
            background: rgba(255,255,255,0.05);
            padding: 2rem;
            border-radius: 20px;
            margin-bottom: 2rem;
        }

        .ranking-podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .podium-place {
            background: rgba(255,255,255,0.05);
            padding: 2rem 1.5rem;
            border-radius: 15px;
            text-align: center;
            min-width: 150px;
        }

        .podium-place.first {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.1));
            border: 2px solid rgba(255, 215, 0, 0.5);
            order: 2;
        }

        .podium-place.second {
            background: linear-gradient(135deg, rgba(192, 192, 192, 0.2), rgba(192, 192, 192, 0.1));
            border: 2px solid rgba(192, 192, 192, 0.5);
            order: 1;
        }

        .podium-place.third {
            background: linear-gradient(135deg, rgba(205, 127, 50, 0.2), rgba(205, 127, 50, 0.1));
            border: 2px solid rgba(205, 127, 50, 0.5);
            order: 3;
        }

        .podium-rank {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .podium-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--azul-claro), var(--violeta-claro));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0 auto 0.8rem;
        }

        .podium-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
        }

        .podium-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--azul-claro);
        }

        /* === SISTEMA DE NOTIFICACIONES TOAST === */
        .toast-container {
            position: fixed;
            top: 100px;
            right: 2rem;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .toast {
            background: rgba(15, 23, 42, 0.98);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            border: 1px solid rgba(255,255,255,0.1);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid var(--verde-exito);
        }

        .toast.error {
            border-left: 4px solid var(--rojo);
        }

        .toast.info {
            border-left: 4px solid var(--azul-claro);
        }

        .toast.warning {
            border-left: 4px solid var(--naranja);
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: bold;
            margin-bottom: 0.2rem;
        }

        .toast-message {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }

        .toast-close {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .toast-close:hover {
            color: var(--blanco);
        }

        /* === REPORTES === */
        .report-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2500;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            padding: 2rem;
        }

        .report-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .report-content {
            background: rgba(15, 23, 42, 0.98);
            border-radius: 20px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 2rem;
        }

        .report-section {
            margin-bottom: 2rem;
        }

        .report-section h3 {
            color: var(--azul-claro);
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        /* === RESPONSIVE === */
        @media (max-width: 768px) {
            .navbar-content {
                flex-direction: column;
            }

            .nav-menu {
                flex-direction: column;
                width: 100%;
            }

            .videos-carousel {
                grid-template-columns: 1fr;
            }

            .progress-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .ranking-podium {
                flex-direction: column;
                align-items: center;
            }

            .podium-place.first,
            .podium-place.second,
            .podium-place.third {
                order: 0;
            }
        }

        /* === FASE 2 === */
        #fase2-content {
            display: none;
        }

        .coming-soon {
            text-align: center;
            padding: 4rem 2rem;
        }

        .coming-soon h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .coming-soon p {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.7);
        }
    </style>
</head>
<body>
    <!-- PANTALLA DE LOGIN -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-logo">
                <h1>ü§ñ AIWIS</h1>
                <p style="color: rgba(255,255,255,0.7);">Portal de Adopci√≥n de IA</p>
            </div>
            <form class="login-form" onsubmit="return false;">
                <div class="form-group">
                    <label for="userSelect">Selecciona tu usuario</label>
                    <select id="userSelect">
                        <option value="">Cargando usuarios...</option>
                    </select>
                </div>
                <div class="login-error" id="loginError">Usuario no v√°lido</div>
                <button type="button" class="login-btn" onclick="iniciarSesion()">
                    Ingresar al Portal
                </button>
            </form>
        </div>
    </div>

    <!-- BARRA DE NAVEGACI√ìN -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <h1>ü§ñ AIWIS</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="#clases" class="nav-link active" onclick="mostrarSeccion('clases')">üìö Mis Clases</a></li>
                <li><a href="#admin" class="nav-link" onclick="mostrarSeccion('admin')" id="adminLink" style="display: none;">‚öôÔ∏è Administraci√≥n</a></li>
            </ul>
            <div class="user-info">
                <span>üë§ <span id="userName">Usuario</span></span>
                <button class="logout-btn" onclick="cerrarSesion()">Salir</button>
            </div>
        </div>
    </nav>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="main-container">
        
        <!-- SECCI√ìN DE CLASES -->
        <div id="classesContent" style="display: none;">
            <h1 class="section-title">üìö Portal de Clases AIWIS</h1>

            <!-- TARJETA DE PROGRESO -->
            <div class="progress-card">
                <div class="progress-header">
                    <div class="progress-title">Mi Progreso</div>
                    <div class="progress-stats">
                        <div class="stat-item">
                            <div class="stat-number" id="videosCompletados">0</div>
                            <div class="stat-label">Videos Completados</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="totalVideos">20</div>
                            <div class="stat-label">Total de Videos</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number" id="porcentajeProgreso">0%</div>
                            <div class="stat-label">Progreso Global</div>
                        </div>
                    </div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBarFill" style="width: 0%;">0%</div>
                </div>
            </div>

            <!-- SELECTOR DE FASES -->
            <div class="phase-selector">
                <button class="fase-btn active" onclick="mostrarFase(1)">üéØ Fase 1: Fundamentos</button>
                <button class="fase-btn" onclick="mostrarFase(2)">üöÄ Fase 2: Avanzado</button>
            </div>

            <!-- CONTENIDO FASE 1 -->
            <div id="fase1-content">
                <!-- SELECTOR DE SEMANAS -->
                <div class="week-selector">
                    <button class="week-btn active" onclick="mostrarSemana(1)">üìÖ Semana 1</button>
                    <button class="week-btn" onclick="mostrarSemana(2)">üìÖ Semana 2</button>
                    <button class="week-btn" onclick="mostrarSemana(3)">üìÖ Semana 3</button>
                    <button class="week-btn" onclick="mostrarSemana(4)">üìÖ Semana 4</button>
                </div>

                <!-- SEMANAS -->
                <div id="week1" class="week-content active">
                    <div id="carousel-week1" class="videos-carousel">
                        <p id="classesLoading" style="text-align: center; color: rgba(255,255,255,0.6);">Cargando clases...</p>
                    </div>
                </div>

                <div id="week2" class="week-content">
                    <div id="carousel-week2" class="videos-carousel"></div>
                </div>

                <div id="week3" class="week-content">
                    <div id="carousel-week3" class="videos-carousel"></div>
                </div>

                <div id="week4" class="week-content">
                    <div id="carousel-week4" class="videos-carousel"></div>
                </div>
            </div>

            <!-- CONTENIDO FASE 2 -->
            <div id="fase2-content">
                <div class="coming-soon">
                    <h2>üöÄ Fase 2: Pr√≥ximamente</h2>
                    <p>Contenido avanzado disponible pronto</p>
                </div>
            </div>
        </div>

        <!-- PANEL DE ADMINISTRACI√ìN (SOLO MENTORES) -->
        <div id="adminPanel">
            <h1 class="section-title">‚öôÔ∏è Panel de Administraci√≥n</h1>
            
            <div class="admin-header">
                <h2>üìä Dashboard de M√©tricas</h2>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="metricTotalStudents">0</div>
                        <div class="metric-label">Total Estudiantes</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricAvgProgress">0%</div>
                        <div class="metric-label">Progreso Promedio</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricCompleted">0</div>
                        <div class="metric-label">Completados</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricInProgress">0</div>
                        <div class="metric-label">En Progreso</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricTotalVideos">0</div>
                        <div class="metric-label">Videos Vistos (Total)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="metricTopStudent">-</div>
                        <div class="metric-label">Estudiante Destacado</div>
                    </div>
                </div>
            </div>

            <!-- CONTROLES -->
            <div class="admin-controls">
                <button class="admin-btn" onclick="loadDashboardMetrics()">üîÑ Actualizar Datos</button>
                <button class="admin-btn" onclick="generateConsolidatedReport()">üìÑ Generar Reporte</button>
            </div>

            <!-- FILTROS -->
            <div class="filters-section">
                <input type="text" class="filter-input" id="searchInput" placeholder="üîç Buscar por nombre o email..." oninput="filterStudents()">
                <select class="filter-input" id="statusFilter" onchange="filterStudents()">
                    <option value="all">Todos los estados</option>
                    <option value="Completado">Completado</option>
                    <option value="En progreso">En progreso</option>
                    <option value="No iniciado">No iniciado</option>
                </select>
                <select class="filter-input" id="roleFilter" onchange="filterStudents()">
                    <option value="all">Todos los roles</option>
                    <option value="Estudiante AIWIS">Estudiante AIWIS</option>
                    <option value="Mentor AIWIS">Mentor AIWIS</option>
                </select>
            </div>

            <!-- RANKING -->
            <div class="ranking-section">
                <h2 style="text-align: center; margin-bottom: 2rem;">üèÜ Top 3 Estudiantes</h2>
                <div class="ranking-podium" id="rankingPodium">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>

            <!-- TABLA DE ESTUDIANTES -->
            <div class="students-table-container">
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Nombre</th>
                            <th>Rol</th>
                            <th>Progreso</th>
                            <th>Videos</th>
                            <th>Estado</th>
                            <th>√öltimo Acceso</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody">
                        <!-- Se llenar√° din√°micamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- GRID DE ESTUDIANTES (PARA TODOS) -->
        <div id="studentsGrid">
            <p id="studentsLoading" style="text-align: center; color: rgba(255,255,255,0.6);">Cargando datos de estudiantes...</p>
        </div>
    </div>

    <!-- MODAL DE CLASE -->
    <div class="class-modal" id="classModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h2 id="modalTitle">T√≠tulo de la Clase</h2>
                    <div class="modal-meta">
                        <span id="modalWeek">üìÖ Semana X</span>
                        <span id="modalDay">üóìÔ∏è D√≠a</span>
                    </div>
                </div>
                <button class="modal-close-btn" onclick="closeClassModal()">‚úï</button>
            </div>
            
            <iframe id="modalVideo" class="modal-video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            
            <div class="modal-tabs">
                <button class="modal-tab active" onclick="switchTab('description')">üìù Descripci√≥n</button>
                <button class="modal-tab" onclick="switchTab('transcript')">üìÑ Transcripci√≥n</button>
            </div>
            
            <div class="modal-body">
                <div id="tab-description" class="tab-content active">
                    <div id="modalDescription"></div>
                </div>
                <div id="tab-transcript" class="tab-content">
                    <div id="modalTranscript"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE REPORTES -->
    <div class="report-modal" id="reportModal">
        <div class="report-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2>üìä Reporte Consolidado</h2>
                <button class="modal-close-btn" onclick="closeReportModal()">‚úï</button>
            </div>
            <div id="reportContent"></div>
            <div style="margin-top: 2rem; text-align: center;">
                <button class="admin-btn" onclick="printReport()">üñ®Ô∏è Imprimir Reporte</button>
                <button class="admin-btn" onclick="closeReportModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- INDICADOR DE SINCRONIZACI√ìN -->
    <div class="sync-indicator" id="syncIndicator">
        <div class="sync-spinner"></div>
        <span>Sincronizando progreso...</span>
    </div>

    <!-- CONTENEDOR DE TOASTS -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- JAVASCRIPT -->
    <script>
        // ========================================
        // CONFIGURACI√ìN - ¬°IMPORTANTE! EDITA ESTAS VARIABLES
        // ========================================
        
        // üîπ PASO 1: Configura tu Google Sheet
        const SPREADSHEET_ID = '1phVrsMcggSp6K-spkhvSRvp5P_BEaH7ABGz7WLsaR1s'; // Tu ID de Google Sheets
        const API_KEY = 'AKfycbwMmdYNGc8UAbkc7UqYMD36rQPtpJzMCwWUpR9J2R_BcrvCZVe2guz4Hdwtt5AMsq-t0A'; // Tu API Key de Google
        
        // üîπ PASO 2: Configura tu Web App URL de Google Apps Script
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwMmdYNGc8UAbkc7UqYMD36rQPtpJzMCwWUpR9J2R_BcrvCZVe2guz4Hdwtt5AMsq-t0A/exec'; // URL del Web App desplegado
        
        // üîπ PASO 3: Configura el repositorio de GitHub (opcional)
        const GITHUB_REPO = 'https://raw.githubusercontent.com/soporteaiwis-lab/ada/main'; // Ej: https://raw.githubusercontent.com/usuario/repo/main

        // ========================================
        // VARIABLES GLOBALES
        // ========================================
        let currentUser = null;
        let userProgress = {};
        let allUsers = [];

        // Estructura de datos de clases
        const clasesData = {
            1: { // Semana 1
                lunes: { title: "Introducci√≥n a la IA", desc: "Conceptos fundamentales y aplicaciones" },
                martes: { title: "Fundamentos de ML", desc: "Machine Learning y sus bases" },
                miercoles: { title: "IA Generativa", desc: "Modelos generativos y su uso" },
                jueves: { title: "Prompting Avanzado", desc: "T√©cnicas profesionales de prompting" },
                viernes: { title: "√âtica en IA", desc: "Consideraciones √©ticas y responsables" }
            },
            2: { // Semana 2
                lunes: { title: "ChatGPT Avanzado", desc: "Uso profesional de ChatGPT" },
                martes: { title: "Claude & Gemini", desc: "Comparativa de modelos de lenguaje" },
                miercoles: { title: "Automatizaci√≥n con IA", desc: "Flujos de trabajo inteligentes" },
                jueves: { title: "IA en Negocios", desc: "Casos de uso empresariales" },
                viernes: { title: "Proyecto Pr√°ctico 1", desc: "Implementaci√≥n real" }
            },
            3: { // Semana 3
                lunes: { title: "An√°lisis de Datos con IA", desc: "IA para an√°lisis predictivo" },
                martes: { title: "Generaci√≥n de Contenido", desc: "Creaci√≥n automatizada de contenido" },
                miercoles: { title: "IA en Marketing", desc: "Estrategias de marketing con IA" },
                jueves: { title: "Personalizaci√≥n con IA", desc: "Experiencias personalizadas" },
                viernes: { title: "Proyecto Pr√°ctico 2", desc: "Caso de estudio real" }
            },
            4: { // Semana 4
                lunes: { title: "Implementaci√≥n Organizacional", desc: "Adopci√≥n de IA en empresas" },
                martes: { title: "ROI de IA", desc: "Medici√≥n de retorno de inversi√≥n" },
                miercoles: { title: "Gesti√≥n del Cambio", desc: "Estrategias de transformaci√≥n" },
                jueves: { title: "Futuro de la IA", desc: "Tendencias y proyecciones" },
                viernes: { title: "Proyecto Final", desc: "Presentaci√≥n de proyecto integrador" }
            }
        };

        const diasSemana = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes'];

        // ========================================
        // GESTI√ìN DE USUARIOS Y LOGIN
        // ========================================
        async function cargarUsuariosLogin() {
            const select = document.getElementById('userSelect');
            
            if (!SPREADSHEET_ID || !API_KEY) {
                select.innerHTML = '<option value="">‚ö†Ô∏è Configura tu Google Sheets primero</option>';
                return;
            }

            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Usuarios!A2:C100?key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.values) {
                    allUsers = data.values;
                    select.innerHTML = '<option value="">-- Selecciona tu usuario --</option>';
                    
                    data.values.forEach((row, index) => {
                        if (row[0]) { // Si hay email
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = `${row[1]} (${row[0]})`;
                            option.dataset.email = row[0];
                            option.dataset.nombre = row[1];
                            option.dataset.rol = row[2];
                            select.appendChild(option);
                        }
                    });
                } else {
                    select.innerHTML = '<option value="">No hay usuarios disponibles</option>';
                }
            } catch (error) {
                console.error('Error cargando usuarios:', error);
                select.innerHTML = '<option value="">‚ùå Error al cargar usuarios</option>';
            }
        }

        async function iniciarSesion() {
            const select = document.getElementById('userSelect');
            const selectedOption = select.options[select.selectedIndex];
            const userIndex = select.value;

            if (!userIndex || userIndex === "") {
                document.getElementById('loginError').classList.add('show');
                return;
            }

            const email = selectedOption.dataset.email;
            const nombre = selectedOption.dataset.nombre;
            const rol = selectedOption.dataset.rol;

            currentUser = {
                email: email,
                nombre: nombre,
                rol: rol,
                index: parseInt(userIndex)
            };

            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            await cargarProgreso();
            loadActivityLogs();

            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('userName').textContent = nombre;

            cargarDatosUsuarios();
            cargarVideos();
            
            // Mostrar panel de admin si es mentor
            if (rol === 'Mentor AIWIS') {
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('studentsGrid').style.display = 'none';
                document.getElementById('adminLink').style.display = 'block';
                
                if (SPREADSHEET_ID && API_KEY) {
                    loadDashboardMetrics();
                }
            }
            
            // Notificaci√≥n de bienvenida
            setTimeout(() => {
                showToast('success', `¬°Bienvenido/a!`, `Hola ${nombre.split(' ')[0]}, es un placer verte de nuevo üëã`);
            }, 500);
            
            // Registrar login
            logActivity('login', 'Usuario ingres√≥ al portal');
        }

        function cerrarSesion() {
            // Registrar logout antes de limpiar
            if (currentUser) {
                logActivity('logout', 'Usuario cerr√≥ sesi√≥n');
                showToast('info', 'Hasta pronto', `Nos vemos pronto, ${currentUser.nombre.split(' ')[0]} üëã`);
            }
            
            localStorage.removeItem('currentUser');
            currentUser = null;
            userProgress = {};
            
            document.getElementById('loginOverlay').classList.remove('hidden');
            document.getElementById('studentsGrid').innerHTML = '';
            document.getElementById('classesContent').style.display = 'none';
        }

        function verificarUsuario() {
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('userName').textContent = currentUser.nombre;
                document.getElementById('loginOverlay').classList.add('hidden');
                return true;
            } else {
                document.getElementById('loginOverlay').classList.remove('hidden');
                return false;
            }
        }

        // ========================================
        // GESTI√ìN DE PROGRESO - ¬°CORREGIDO!
        // ========================================
        async function cargarProgreso() {
            if (!currentUser) return;

            const localProgress = localStorage.getItem(`progress_${currentUser.email}`);
            if (localProgress) {
                userProgress = JSON.parse(localProgress);
            }

            actualizarEstadisticasProgreso();
        }

        async function guardarProgreso() {
            if (!currentUser) return;
            localStorage.setItem(`progress_${currentUser.email}`, JSON.stringify(userProgress));
        }

        function marcarProgreso(event, semana, dia) {
            event.stopPropagation();
            
            const videoKey = `s${semana}-${dia}`;
            const wasChecked = userProgress[videoKey];
            userProgress[videoKey] = event.target.checked;
            
            guardarProgreso();
            actualizarEstadisticasProgreso();
            
            // Sincronizar autom√°ticamente con Google Sheets
            sincronizarProgresoGoogleSheets();
            
            // Registrar actividad
            const action = event.target.checked ? 'complet√≥' : 'desmarc√≥';
            logActivity('video', `${action} video de Semana ${semana} - ${dia.charAt(0).toUpperCase() + dia.slice(1)}`);
            
            setTimeout(() => {
                cargarVideos();
            }, 300);
        }

        function actualizarEstadisticasProgreso() {
            const totalVideos = 20;
            const completados = Object.values(userProgress).filter(v => v === true).length;
            const porcentaje = Math.round((completados / totalVideos) * 100);

            document.getElementById('videosCompletados').textContent = completados;
            document.getElementById('totalVideos').textContent = totalVideos;
            document.getElementById('porcentajeProgreso').textContent = `${porcentaje}%`;
            
            const progressBar = document.getElementById('progressBarFill');
            progressBar.style.width = `${porcentaje}%`;
            progressBar.textContent = `${porcentaje}%`;
        }

        // ========================================
        // SINCRONIZACI√ìN CON GOOGLE SHEETS - ¬°CORREGIDO!
        // ========================================
        async function sincronizarProgresoGoogleSheets() {
            if (!currentUser || !WEB_APP_URL || WEB_APP_URL === '') {
                console.warn('‚ö†Ô∏è No se puede sincronizar: falta WEB_APP_URL o usuario no autenticado');
                return;
            }
            
            try {
                showSyncIndicator();
                
                const totalVideos = 20;
                const completados = Object.values(userProgress).filter(v => v === true).length;
                const porcentajeGlobal = completados / totalVideos;
                
                // Preparar datos en el formato que espera el Google Apps Script
                const dataToSend = {
                    action: 'updateProgress',
                    email: currentUser.email,
                    globalProgress: porcentajeGlobal, // Enviar como decimal (0.0 a 1.0)
                    fase1Progress: userProgress
                };
                
                console.log('üì§ Enviando datos a Google Sheets:', dataToSend);
                
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSend)
                });
                
                const result = await response.json();
                console.log('üì• Respuesta de Google Sheets:', result);
                
                hideSyncIndicator();
                
                if (result.status === 'success') {
                    showToast('success', 'Sincronizado', 'Tu progreso se guard√≥ correctamente en Google Sheets');
                    logActivity('sync', `Progreso sincronizado: ${Math.round(porcentajeGlobal * 100)}%`);
                } else {
                    showToast('warning', 'Sincronizaci√≥n parcial', result.message || 'Se guard√≥ localmente pero hubo un problema con Google Sheets');
                }
                
            } catch (error) {
                hideSyncIndicator();
                console.error('‚ùå Error sincronizando progreso:', error);
                showToast('error', 'Error de sincronizaci√≥n', 'No se pudo sincronizar con Google Sheets. Tu progreso se guard√≥ localmente.');
            }
        }

        // ========================================
        // SISTEMA DE NOTIFICACIONES TOAST
        // ========================================
        function showToast(type, title, message, duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è'
            };
            
            toast.innerHTML = `
                <span class="toast-icon">${icons[type]}</span>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">‚úï</button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // ========================================
        // INDICADOR DE SINCRONIZACI√ìN
        // ========================================
        function showSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            indicator.classList.add('show');
        }

        function hideSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            indicator.classList.remove('show');
        }

        // ========================================
        // SISTEMA DE LOGS DE ACTIVIDAD
        // ========================================
        let activityLogs = [];

        function logActivity(type, message) {
            const log = {
                type: type,
                message: message,
                timestamp: new Date().toISOString(),
                user: currentUser ? currentUser.email : 'unknown'
            };
            
            activityLogs.push(log);
            
            // Guardar en localStorage
            localStorage.setItem(`logs_${currentUser.email}`, JSON.stringify(activityLogs.slice(-50))); // Solo √∫ltimos 50
        }

        function loadActivityLogs() {
            if (currentUser) {
                const saved = localStorage.getItem(`logs_${currentUser.email}`);
                if (saved) {
                    activityLogs = JSON.parse(saved);
                }
            }
        }

        // ========================================
        // DASHBOARD DE M√âTRICAS (PARA MENTORES)
        // ========================================
        let allStudentsData = [];

        async function loadDashboardMetrics() {
            if (!currentUser || currentUser.rol !== 'Mentor AIWIS') return;
            if (!WEB_APP_URL || WEB_APP_URL === '') {
                showToast('warning', 'Configuraci√≥n incompleta', 'Debes configurar WEB_APP_URL en el c√≥digo');
                return;
            }
            
            try {
                const url = `${WEB_APP_URL}?action=getAllStudents`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.status === 'success' && data.students) {
                    allStudentsData = data.students.map(student => ({
                        email: student.email,
                        nombre: student.name,
                        rol: student.role,
                        porcentaje: student.progress,
                        completados: Object.values(student.fase1Progress || {}).filter(v => v === true).length,
                        total: 20,
                        json: JSON.stringify(student.fase1Progress || {}),
                        ultimaActualizacion: new Date().toISOString(),
                        semana1: 0,
                        semana2: 0,
                        semana3: 0,
                        semana4: 0,
                        estado: student.progress === 0 ? 'No iniciado' : student.progress === 100 ? 'Completado' : 'En progreso',
                        diasActivo: 0,
                        ultimoAcceso: new Date().toISOString()
                    }));
                    
                    updateDashboardMetrics();
                    renderStudentsTable();
                    renderRanking();
                } else {
                    showToast('error', 'Error', 'No se pudieron cargar los datos de estudiantes');
                }
            } catch (error) {
                console.error('Error cargando m√©tricas:', error);
                showToast('warning', 'Advertencia', 'No se pudieron cargar las m√©tricas del dashboard');
            }
        }

        function updateDashboardMetrics() {
            const totalStudents = allStudentsData.length;
            const avgProgress = totalStudents > 0 ? Math.round(
                allStudentsData.reduce((sum, s) => sum + s.porcentaje, 0) / totalStudents
            ) : 0;
            const completed = allStudentsData.filter(s => s.estado === 'Completado').length;
            const inProgress = allStudentsData.filter(s => s.estado === 'En progreso').length;
            const totalVideosWatched = allStudentsData.reduce((sum, s) => sum + s.completados, 0);
            const topStudent = allStudentsData.length > 0 ? 
                allStudentsData.reduce((top, s) => s.porcentaje > top.porcentaje ? s : top).nombre : '-';
            
            document.getElementById('metricTotalStudents').textContent = totalStudents;
            document.getElementById('metricAvgProgress').textContent = avgProgress + '%';
            document.getElementById('metricCompleted').textContent = completed;
            document.getElementById('metricInProgress').textContent = inProgress;
            document.getElementById('metricTotalVideos').textContent = totalVideosWatched;
            document.getElementById('metricTopStudent').textContent = topStudent.split(' ')[0] || '-';
        }

        function renderStudentsTable() {
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';
            
            allStudentsData
                .sort((a, b) => b.porcentaje - a.porcentaje)
                .forEach((student, index) => {
                    const statusClass = student.estado.toLowerCase().replace(' ', '-');
                    const lastActivity = student.ultimoAcceso ? 
                        new Date(student.ultimoAcceso).toLocaleDateString('es-CL') : 'Sin actividad';
                    
                    const row = `
                        <tr>
                            <td>${index + 1}</td>
                            <td><strong>${student.nombre}</strong></td>
                            <td>${student.rol}</td>
                            <td>
                                <div class="progress-mini">
                                    <div class="progress-mini-bar">
                                        <div class="progress-mini-fill" style="width: ${student.porcentaje}%"></div>
                                    </div>
                                    <span><strong>${student.porcentaje}%</strong></span>
                                </div>
                            </td>
                            <td>${student.completados}/${student.total}</td>
                            <td><span class="status-badge ${statusClass}">${student.estado}</span></td>
                            <td>${lastActivity}</td>
                            <td>
                                <button class="admin-btn" style="padding: 0.5rem 1rem; font-size: 0.85rem;" 
                                        onclick="viewStudentDetail('${student.email}')">
                                    Ver Detalle
                                </button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
        }

        function renderRanking() {
            const podium = document.getElementById('rankingPodium');
            const top3 = allStudentsData
                .sort((a, b) => b.porcentaje - a.porcentaje)
                .slice(0, 3);
            
            podium.innerHTML = '';
            
            const positions = ['second', 'first', 'third'];
            const medals = ['ü•à', 'ü•á', 'ü•â'];
            
            top3.forEach((student, index) => {
                const place = `
                    <div class="podium-place ${positions[index]}">
                        <div class="podium-rank">${medals[index]}</div>
                        <div class="podium-avatar">${student.nombre.charAt(0)}</div>
                        <div class="podium-name">${student.nombre.split(' ')[0]}</div>
                        <div class="podium-score">${student.porcentaje}%</div>
                    </div>
                `;
                podium.innerHTML += place;
            });
        }

        // === FILTROS Y B√öSQUEDA ===
        function filterStudents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const roleFilter = document.getElementById('roleFilter').value;
            
            const filtered = allStudentsData.filter(student => {
                const matchesSearch = student.nombre.toLowerCase().includes(searchTerm) || 
                                    student.email.toLowerCase().includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || student.estado === statusFilter;
                const matchesRole = roleFilter === 'all' || student.rol === roleFilter;
                
                return matchesSearch && matchesStatus && matchesRole;
            });
            
            // Renderizar solo los filtrados
            const tbody = document.getElementById('studentsTableBody');
            tbody.innerHTML = '';
            
            filtered.forEach((student, index) => {
                const statusClass = student.estado.toLowerCase().replace(' ', '-');
                const lastActivity = student.ultimoAcceso ? 
                    new Date(student.ultimoAcceso).toLocaleDateString('es-CL') : 'Sin actividad';
                
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${student.nombre}</strong></td>
                        <td>${student.rol}</td>
                        <td>
                            <div class="progress-mini">
                                <div class="progress-mini-bar">
                                    <div class="progress-mini-fill" style="width: ${student.porcentaje}%"></div>
                                </div>
                                <span><strong>${student.porcentaje}%</strong></span>
                            </div>
                        </td>
                        <td>${student.completados}/${student.total}</td>
                        <td><span class="status-badge ${statusClass}">${student.estado}</span></td>
                        <td>${lastActivity}</td>
                        <td>
                            <button class="admin-btn" style="padding: 0.5rem 1rem; font-size: 0.85rem;" 
                                    onclick="viewStudentDetail('${student.email}')">
                                Ver Detalle
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        // === GENERACI√ìN DE REPORTES ===
        function generateConsolidatedReport() {
            if (!allStudentsData.length) {
                showToast('warning', 'Sin datos', 'No hay datos de estudiantes para generar el reporte');
                return;
            }
            
            const totalStudents = allStudentsData.length;
            const avgProgress = Math.round(
                allStudentsData.reduce((sum, s) => sum + s.porcentaje, 0) / totalStudents
            );
            const completed = allStudentsData.filter(s => s.estado === 'Completado').length;
            const inProgress = allStudentsData.filter(s => s.estado === 'En progreso').length;
            const notStarted = allStudentsData.filter(s => s.estado === 'No iniciado').length;
            
            let reportHTML = `
                <div class="report-section">
                    <h3>üìä Resumen General</h3>
                    <p><strong>Fecha del Reporte:</strong> ${new Date().toLocaleDateString('es-CL', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    })}</p>
                    <p><strong>Total de Estudiantes:</strong> ${totalStudents}</p>
                    <p><strong>Progreso Promedio:</strong> ${avgProgress}%</p>
                    <p><strong>Estudiantes Completados:</strong> ${completed}</p>
                    <p><strong>Estudiantes En Progreso:</strong> ${inProgress}</p>
                    <p><strong>Estudiantes Sin Iniciar:</strong> ${notStarted}</p>
                </div>

                <div class="report-section">
                    <h3>üéì Detalle por Estudiante</h3>
                    <table class="students-table" style="margin-top: 1rem;">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nombre</th>
                                <th>Email</th>
                                <th>Progreso</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            allStudentsData
                .sort((a, b) => b.porcentaje - a.porcentaje)
                .forEach((student, index) => {
                    reportHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${student.nombre}</td>
                            <td>${student.email}</td>
                            <td>${student.porcentaje}%</td>
                            <td>${student.estado}</td>
                        </tr>
                    `;
                });
            
            reportHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportHTML;
            document.getElementById('reportModal').classList.add('active');
        }

        function closeReportModal() {
            document.getElementById('reportModal').classList.remove('active');
        }

        function printReport() {
            window.print();
        }

        function viewStudentDetail(email) {
            const student = allStudentsData.find(s => s.email === email);
            if (student) {
                alert(`Detalle de ${student.nombre}\n\nProgreso: ${student.porcentaje}%\nVideos completados: ${student.completados}/${student.total}\nEstado: ${student.estado}`);
            }
        }

        // ========================================
        // CARGA DE DATOS DE USUARIOS
        // ========================================
        async function cargarDatosUsuarios() {
            // Esta funci√≥n ya no es necesaria para la tabla de estudiantes
            // pero la dejamos por compatibilidad
        }

        // ========================================
        // GESTI√ìN DE VIDEOS
        // ========================================
        let videosPorSemana = {1: [], 2: [], 3: [], 4: []};

        async function cargarVideos() {
            if (!SPREADSHEET_ID || !API_KEY) {
                renderizarVideosDefault();
                return;
            }

            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Videos!A2:C100?key=${API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.values) {
                    // Resetear videos por semana
                    videosPorSemana = {1: [], 2: [], 3: [], 4: []};
                    
                    data.values.forEach(row => {
                        const semana = parseInt(row[0]);
                        const dia = (row[1] || '').toLowerCase().trim();
                        const url = row[2];
                        
                        if (semana >= 1 && semana <= 4 && dia && url) {
                            videosPorSemana[semana].push({ dia, url });
                        }
                    });
                    
                    renderizarVideos();
                    document.getElementById('classesContent').style.display = 'block';
                } else {
                    renderizarVideosDefault();
                    document.getElementById('classesContent').style.display = 'block';
                }
            } catch (error) {
                console.error('Error cargando videos:', error);
                renderizarVideosDefault();
                document.getElementById('classesContent').style.display = 'block';
            }
        }

        function renderizarVideos() {
            for (let semana = 1; semana <= 4; semana++) {
                const carousel = document.getElementById(`carousel-week${semana}`);
                carousel.innerHTML = '';
                
                diasSemana.forEach(dia => {
                    const videoData = videosPorSemana[semana].find(v => v.dia.toLowerCase() === dia);
                    const claseInfo = clasesData[semana][dia];
                    
                    if (claseInfo) {
                        const videoUrl = videoData ? videoData.url : '';
                        const videoId = extraerVideoId(videoUrl);
                        
                        carousel.innerHTML += crearVideoCard(semana, dia, claseInfo, videoId);
                    }
                });
            }
        }

        function renderizarVideosDefault() {
            for (let semana = 1; semana <= 4; semana++) {
                const carousel = document.getElementById(`carousel-week${semana}`);
                carousel.innerHTML = '';
                
                diasSemana.forEach(dia => {
                    const claseInfo = clasesData[semana][dia];
                    if (claseInfo) {
                        carousel.innerHTML += crearVideoCard(semana, dia, claseInfo, '');
                    }
                });
            }
        }

        function extraerVideoId(url) {
            if (!url) return '';
            const patterns = [
                /youtube\.com\/embed\/([^?]+)/,
                /youtube\.com\/watch\?v=([^&]+)/,
                /youtu\.be\/([^?]+)/
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            return '';
        }

        function crearVideoCard(semana, dia, claseInfo, videoId) {
            const diaCapitalizado = dia.charAt(0).toUpperCase() + dia.slice(1);
            const thumbnail = videoId ? `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : '';
            const hasVideo = videoId !== '';
            
            const videoKey = `s${semana}-${dia}`;
            const isCompleted = userProgress[videoKey] || false;
            
            return `
                <div class="video-card" onclick="openClassModal(${semana}, '${dia}', '${videoId}')">
                    <div class="video-thumbnail">
                        ${thumbnail ? `<img src="${thumbnail}" alt="${claseInfo.title}">` : '<span style="font-size: 3rem;">üé¨</span>'}
                        ${hasVideo ? '<div class="play-button">‚ñ∂</div>' : ''}
                        ${hasVideo ? `
                            <div class="video-progress">
                                <input type="checkbox" 
                                       class="progress-checkbox" 
                                       ${isCompleted ? 'checked' : ''} 
                                       onchange="marcarProgreso(event, ${semana}, '${dia}')"
                                       onclick="event.stopPropagation()">
                            </div>
                        ` : ''}
                        ${isCompleted ? '<div class="progress-badge">‚úì Visto</div>' : ''}
                    </div>
                    <div class="video-info">
                        <div class="video-day">${diaCapitalizado}</div>
                        <div class="video-title">${claseInfo.title}</div>
                        <div class="video-description">${claseInfo.desc}</div>
                        <div class="video-meta">
                            <span>‚è±Ô∏è 60 min</span>
                            ${hasVideo ? '<span>‚úÖ Disponible</span>' : '<span style="color: var(--naranja);">üìÖ Pr√≥ximamente</span>'}
                        </div>
                    </div>
                </div>
            `;
        }

        // === MODAL DE CLASE ===
        async function openClassModal(semana, dia, videoId) {
            const modal = document.getElementById('classModal');
            const claseInfo = clasesData[semana][dia];
            const diaCapitalizado = dia.charAt(0).toUpperCase() + dia.slice(1);
            
            const videoFrame = document.getElementById('modalVideo');
            if (videoId) {
                videoFrame.src = `https://www.youtube.com/embed/${videoId}`;
            } else {
                videoFrame.src = '';
            }
            
            document.getElementById('modalTitle').textContent = claseInfo.title;
            document.getElementById('modalWeek').textContent = `üìÖ Semana ${semana}`;
            document.getElementById('modalDay').textContent = `üóìÔ∏è ${diaCapitalizado}`;
            document.getElementById('modalDescription').innerHTML = `<p>${claseInfo.desc}</p>`;
            
            await cargarTranscripcion(semana, dia);
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeClassModal() {
            const modal = document.getElementById('classModal');
            modal.classList.remove('active');
            document.getElementById('modalVideo').src = '';
            document.body.style.overflow = 'auto';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.modal-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        async function cargarTranscripcion(semana, dia) {
            const transcriptDiv = document.getElementById('modalTranscript');
            transcriptDiv.innerHTML = '<p style="text-align: center; color: rgba(255,255,255,0.5);">Cargando transcripci√≥n...</p>';
            
            try {
                const url = `${GITHUB_REPO}/transcripts/fase1-semana${semana}-${dia}.md`;
                const response = await fetch(url);
                
                if (response.ok) {
                    const text = await response.text();
                    const html = text
                        .replace(/## (.*)/g, '<h4>$1</h4>')
                        .replace(/\n\n/g, '</p><p>')
                        .replace(/^(.+)$/gm, '<p>$1</p>');
                    transcriptDiv.innerHTML = html;
                } else {
                    transcriptDiv.innerHTML = `
                        <p style="text-align: center; color: rgba(255,255,255,0.6);">
                            üìù Transcripci√≥n no disponible a√∫n.<br>
                            <small>Se agregar√° despu√©s de la clase.</small>
                        </p>
                    `;
                }
            } catch (error) {
                console.error('Error cargando transcripci√≥n:', error);
                transcriptDiv.innerHTML = '<p style="text-align: center; color: var(--naranja);">Error al cargar transcripci√≥n</p>';
            }
        }

        // === NAVEGACI√ìN DE FASES Y SEMANAS ===
        function mostrarFase(faseNum) {
            document.querySelectorAll('.fase-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.fase-btn')[faseNum - 1].classList.add('active');
            
            if (faseNum === 1) {
                document.getElementById('fase1-content').style.display = 'block';
                document.getElementById('fase2-content').style.display = 'none';
            } else {
                document.getElementById('fase1-content').style.display = 'none';
                document.getElementById('fase2-content').style.display = 'block';
            }
        }

        function mostrarSemana(semanaNum) {
            document.querySelectorAll('.week-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.week-btn')[semanaNum - 1].classList.add('active');
            
            document.querySelectorAll('.week-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`week${semanaNum}`).classList.add('active');
        }

        function mostrarSeccion(seccion) {
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            
            if (seccion === 'clases') {
                event.target.classList.add('active');
                document.getElementById('classesContent').style.display = 'block';
                document.getElementById('adminPanel').style.display = 'none';
            } else if (seccion === 'admin') {
                event.target.classList.add('active');
                document.getElementById('classesContent').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                loadDashboardMetrics();
            }
        }

        // === INICIALIZACI√ìN ===
        document.addEventListener('DOMContentLoaded', () => {
            cargarUsuariosLogin();
            
            const isLoggedIn = verificarUsuario();
            
            if (isLoggedIn) {
                cargarProgreso();
                loadActivityLogs();
                
                // Mostrar panel de administraci√≥n si es mentor
                if (currentUser && currentUser.rol === 'Mentor AIWIS') {
                    document.getElementById('adminPanel').style.display = 'block';
                    document.getElementById('studentsGrid').style.display = 'none';
                    document.getElementById('adminLink').style.display = 'block';
                    
                    // Cargar dashboard de m√©tricas
                    if (WEB_APP_URL && WEB_APP_URL !== '') {
                        loadDashboardMetrics();
                    }
                }
                
                if (SPREADSHEET_ID && API_KEY) {
                    cargarDatosUsuarios();
                    cargarVideos();
                } else {
                    document.getElementById('studentsLoading').innerHTML = '<p style="color: var(--naranja);">‚ö†Ô∏è Configura tu Google Sheets API</p>';
                    document.getElementById('classesLoading').innerHTML = '<p style="color: var(--naranja);">‚ö†Ô∏è Configura tu Google Sheets API</p>';
                }
                
                // Notificaci√≥n de bienvenida
                setTimeout(() => {
                    showToast('success', `¬°Bienvenido/a!`, `Hola ${currentUser.nombre.split(' ')[0]}, es un placer verte de nuevo üëã`);
                }, 500);
                
                // Registrar login
                logActivity('login', 'Usuario ingres√≥ al portal');
            }
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeClassModal();
                closeReportModal();
            }
        });
    </script>
</body>
</html>